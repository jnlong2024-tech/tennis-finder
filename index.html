<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç½‘çƒåœºåœ°æœç´¢</title>
<meta property="og:title" content="ç½‘çƒåœºåœ°æœç´¢" />
<meta property="og:description" content="å¿«é€Ÿæ‰¾åˆ°é™„è¿‘ç½‘çƒåœºåœ°ï¼Œæ”¯æŒGPSå®šä½ä¸åŸå¸‚æœç´¢" />
<meta name="description" content="å¿«é€Ÿæ‰¾åˆ°é™„è¿‘ç½‘çƒåœºåœ°ï¼Œæ”¯æŒGPSå®šä½ä¸åŸå¸‚æœç´¢" />

<script>
window._AMapSecurityConfig = {
  securityJsCode: 'e469d71b1acdcc134ef2e6ca1a94757d'
}
</script>
<script src="https://webapi.amap.com/maps?v=2.0&key=78633132e896679bab70212f1aa966e6&plugin=AMap.PlaceSearch,AMap.Geolocation,AMap.CitySearch"></script>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg:        #080d14;
    --surface:   #0f1923;
    --surface2:  #162032;
    --border:    #1e3048;
    --accent:    #c8f000;
    --accent2:   #00c8a0;
    --text:      #e8f0fe;
    --muted:     #4a6080;
    --danger:    #ff6b6b;
  }

  html { scroll-behavior: smooth; }

  body {
    font-family: 'Noto Sans SC', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€ èƒŒæ™¯çº¹ç† â”€â”€ */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      radial-gradient(ellipse 80% 50% at 50% -10%, rgba(200,240,0,0.07) 0%, transparent 60%),
      repeating-linear-gradient(
        0deg,
        transparent,
        transparent 39px,
        rgba(255,255,255,0.015) 39px,
        rgba(255,255,255,0.015) 40px
      ),
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 39px,
        rgba(255,255,255,0.015) 39px,
        rgba(255,255,255,0.015) 40px
      );
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 860px;
    margin: 0 auto;
    padding: 28px 20px 60px;
  }

  /* â”€â”€ å¤´éƒ¨ â”€â”€ */
  header {
    text-align: center;
    margin-bottom: 36px;
    animation: fadeDown 0.6s ease both;
  }

  .logo-line {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 14px;
    margin-bottom: 6px;
  }

  .logo-icon {
    width: 48px;
    height: 48px;
    background: var(--accent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    flex-shrink: 0;
    box-shadow: 0 0 24px rgba(200,240,0,0.35);
  }

  h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(2rem, 8vw, 3.2rem);
    letter-spacing: 4px;
    color: var(--text);
    line-height: 1;
  }

  .subtitle {
    font-size: 12px;
    color: var(--muted);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-top: 4px;
  }

  /* â”€â”€ æœç´¢åŒº â”€â”€ */
  .search-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 16px;
    animation: fadeUp 0.6s 0.1s ease both;
  }

  .search-row {
    display: flex;
    gap: 10px;
    align-items: stretch;
  }

  .input-wrap {
    flex: 1;
    position: relative;
  }

  .input-wrap svg {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted);
    pointer-events: none;
  }

  input {
    width: 100%;
    padding: 13px 16px 13px 42px;
    border-radius: 10px;
    border: 1.5px solid var(--border);
    background: var(--surface2);
    color: var(--text);
    font-size: 15px;
    font-family: 'Noto Sans SC', sans-serif;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(200,240,0,0.1);
  }
  input::placeholder { color: var(--muted); }

  .btn-group {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
  }

  button {
    padding: 0 18px;
    height: 48px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 700;
    font-family: 'Noto Sans SC', sans-serif;
    transition: opacity 0.2s, transform 0.1s, box-shadow 0.2s;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  button:hover:not(:disabled)  { opacity: 0.88; transform: translateY(-1px); }
  button:active:not(:disabled) { transform: scale(0.97) translateY(0); }
  button:disabled { opacity: 0.45; cursor: not-allowed; }

  .btn-locate {
    background: var(--surface2);
    color: var(--text);
    border: 1.5px solid var(--border);
  }
  .btn-locate:hover:not(:disabled) {
    border-color: var(--accent2);
    color: var(--accent2);
  }

  .btn-search {
    background: var(--accent);
    color: #000;
    min-width: 88px;
    justify-content: center;
    box-shadow: 0 4px 16px rgba(200,240,0,0.25);
  }
  .btn-search:hover:not(:disabled) {
    box-shadow: 0 6px 24px rgba(200,240,0,0.4);
  }

  /* â”€â”€ çŠ¶æ€æ  â”€â”€ */
  .status-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 14px;
    font-size: 13px;
    color: var(--muted);
    min-height: 20px;
  }

  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--muted);
    flex-shrink: 0;
    transition: background 0.3s;
  }
  .status-dot.active { background: var(--accent); animation: pulse 1.2s infinite; }
  .status-dot.success { background: var(--accent2); }
  .status-dot.error { background: var(--danger); }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50%       { opacity: 0.5; transform: scale(0.7); }
  }

  /* â”€â”€ åœ°å›¾ â”€â”€ */
  #map {
    width: 100%;
    height: clamp(220px, 40vw, 360px);
    border-radius: 14px;
    margin: 16px 0;
    background: var(--surface);
    overflow: hidden;
    border: 1px solid var(--border);
    animation: fadeUp 0.6s 0.2s ease both;
  }

  /* â”€â”€ ç»“æœåˆ—è¡¨ â”€â”€ */
  .results-header {
    font-size: 12px;
    color: var(--muted);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 14px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
  }

  .results-header span {
    color: var(--accent);
    font-weight: 700;
  }

  .card {
    background: var(--surface);
    padding: 18px 20px;
    border-radius: 14px;
    margin-bottom: 10px;
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    transition: border-color 0.2s, transform 0.2s, box-shadow 0.2s;
    animation: fadeUp 0.4s ease both;
  }
  .card:hover {
    border-color: var(--accent);
    transform: translateX(3px);
    box-shadow: -4px 0 20px rgba(200,240,0,0.08);
  }

  .card-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 6px;
  }

  .card-name {
    font-size: 15px;
    font-weight: 700;
    line-height: 1.4;
    color: var(--text);
  }

  .card-index {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 22px;
    color: var(--border);
    line-height: 1;
    flex-shrink: 0;
  }

  .card-addr {
    color: var(--muted);
    font-size: 13px;
    line-height: 1.6;
    margin-bottom: 10px;
  }

  .card-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 8px;
  }

  .distance-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 10px;
    background: rgba(200,240,0,0.08);
    border: 1px solid rgba(200,240,0,0.2);
    border-radius: 20px;
    color: var(--accent);
    font-size: 12px;
    font-weight: 700;
  }

  .nav-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 7px 16px;
    background: var(--surface2);
    border: 1.5px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    transition: background 0.2s, border-color 0.2s, color 0.2s;
  }
  .nav-btn:hover {
    background: var(--accent);
    border-color: var(--accent);
    color: #000;
  }

  /* â”€â”€ ç©ºçŠ¶æ€ â”€â”€ */
  .empty {
    text-align: center;
    padding: 60px 20px;
    animation: fadeUp 0.4s ease both;
  }

  .empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
  }

  .empty-title {
    font-size: 16px;
    color: var(--muted);
    margin-bottom: 8px;
  }

  .empty-hint {
    font-size: 13px;
    color: var(--border);
  }

  /* â”€â”€ åŠ¨ç”» â”€â”€ */
  @keyframes fadeDown {
    from { opacity: 0; transform: translateY(-16px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* â”€â”€ å“åº”å¼ â”€â”€ */
  @media (max-width: 520px) {
    .search-row { flex-direction: column; }
    .btn-group  { flex-direction: row; }
    .btn-locate, .btn-search { flex: 1; justify-content: center; }
    h1 { font-size: 2.2rem; }
  }
</style>
</head>

<body>
<div class="container">

  <header>
    <div class="logo-line">
      <div class="logo-icon">ğŸ¾</div>
      <h1>ç½‘çƒåœºåœ°æœç´¢</h1>
    </div>
    <div class="subtitle">Tennis Court Finder Â· æ•°æ®æ¥æºï¼šé«˜å¾·åœ°å›¾</div>
  </header>

  <div class="search-wrap">
    <div class="search-row">
      <div class="input-wrap">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
        <input id="cityInput" placeholder="è¾“å…¥åŸå¸‚ï¼Œä¾‹å¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·" />
      </div>
      <div class="btn-group">
        <button class="btn-locate" onclick="getLocation()" id="btnLocate">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <circle cx="12" cy="12" r="3"/><path d="M12 2v3M12 19v3M2 12h3M19 12h3"/>
          </svg>
          å®šä½
        </button>
        <button class="btn-search" onclick="searchCity()" id="btnSearch">æœç´¢</button>
      </div>
    </div>
    <div class="status-bar">
      <div class="status-dot" id="statusDot"></div>
      <span id="status">è¾“å…¥åŸå¸‚æˆ–ç‚¹å‡»å®šä½ï¼Œå³å¯æ‰¾åˆ°é™„è¿‘ç½‘çƒåœº</span>
    </div>
  </div>

  <div id="map"></div>

  <div id="result">
    <div class="empty">
      <div class="empty-icon">ğŸ¾</div>
      <div class="empty-title">è¿˜æ²¡æœ‰æœç´¢ç»“æœ</div>
      <div class="empty-hint">è¾“å…¥åŸå¸‚åç§°æˆ–ç‚¹å‡»ã€Œå®šä½ã€æŒ‰é’®å¼€å§‹æœç´¢</div>
    </div>
  </div>

</div>

<script>
let map = null
let markers = []

function escHtml(str) {
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;')
}

function setStatus(msg, type = 'idle') {
  document.getElementById('status').textContent = msg
  const dot = document.getElementById('statusDot')
  dot.className = 'status-dot'
  if (type === 'loading') dot.classList.add('active')
  else if (type === 'success') dot.classList.add('success')
  else if (type === 'error') dot.classList.add('error')
}

function setLoading(on) {
  const btn = document.getElementById('btnSearch')
  const loc = document.getElementById('btnLocate')
  btn.disabled = on
  loc.disabled = on
  btn.textContent = on ? 'æœç´¢ä¸­â€¦' : 'æœç´¢'
}

function initMap(center) {
  if (!map) {
    map = new AMap.Map('map', {
      zoom: 13,
      center: center,
      mapStyle: 'amap://styles/dark'
    })
  } else {
    map.setCenter(center)
    map.setZoom(13)
  }
}

function clearMarkers() {
  markers.forEach(m => m.setMap(null))
  markers = []
}

function getLocation() {
  setStatus('æ­£åœ¨è·å– GPS å®šä½â€¦', 'loading')
  setLoading(true)

  AMap.plugin('AMap.Geolocation', function () {
    const geo = new AMap.Geolocation({ enableHighAccuracy: true, timeout: 8000 })
    geo.getCurrentPosition(function (status, result) {
      if (status === 'complete') {
        const lng = result.position.lng
        const lat = result.position.lat
        const city = (result.addressComponent && (result.addressComponent.city || result.addressComponent.province)) || ''
        document.getElementById('cityInput').value = city
        setStatus('GPS å®šä½æˆåŠŸï¼š' + city, 'success')
        initMap([lng, lat])
        searchNearby([lng, lat])
      } else {
        ipLocate()
      }
    })
  })
}

function ipLocate() {
  setStatus('GPS å¤±è´¥ï¼Œå°è¯• IP å®šä½â€¦', 'loading')
  AMap.plugin('AMap.CitySearch', function () {
    const cs = new AMap.CitySearch()
    cs.getLocalCity(function (status, result) {
      if (status === 'complete' && result && result.city) {
        document.getElementById('cityInput').value = result.city
        setStatus('IP å®šä½æˆåŠŸï¼š' + result.city, 'success')
        searchCity()
      } else {
        setStatus('å®šä½å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥åŸå¸‚åæœç´¢', 'error')
        setLoading(false)
      }
    })
  })
}

function searchCity() {
  const city = document.getElementById('cityInput').value.trim()
  if (!city) {
    setStatus('è¯·è¾“å…¥åŸå¸‚å', 'error')
    return
  }
  setLoading(true)
  setStatus('æ­£åœ¨æœç´¢ã€Œ' + city + 'ã€çš„ç½‘çƒåœºâ€¦', 'loading')
  doSearch({ city: city })
}

function searchNearby(center) {
  setStatus('æ­£åœ¨æœç´¢é™„è¿‘ç½‘çƒåœºâ€¦', 'loading')
  doSearch({ location: center, radius: 5000 })
}

function doSearch(options) {
  AMap.plugin('AMap.PlaceSearch', function () {
    const psOptions = { pageSize: 20, pageIndex: 1 }
    if (options.city) psOptions.city = options.city

    const ps = new AMap.PlaceSearch(psOptions)

    const callback = function (status, result) {
      setLoading(false)
      if (
        status === 'complete' &&
        result && result.poiList &&
        result.poiList.pois &&
        result.poiList.pois.length > 0
      ) {
        const pois = result.poiList.pois
        const first = pois.find(p => p.location)
        if (first) initMap([first.location.lng, first.location.lat])
        renderList(pois)
        renderMarkers(pois)
        setStatus('å…±æ‰¾åˆ° ' + pois.length + ' ä¸ªåœºåœ°', 'success')
      } else {
        renderList([])
        setStatus('æœªæ‰¾åˆ°ç›¸å…³åœºåœ°ï¼Œè¯·å°è¯•å…¶ä»–åŸå¸‚', 'error')
      }
    }

    if (options.location) {
      const center = new AMap.LngLat(options.location[0], options.location[1])
      ps.searchNearBy('ç½‘çƒåœº', center, options.radius || 5000, callback)
    } else {
      ps.search('ç½‘çƒåœº', callback)
    }
  })
}

function formatDistance(raw) {
  const d = parseFloat(raw)
  if (isNaN(d) || d <= 0) return null
  return d >= 1000 ? (d / 1000).toFixed(1) + ' km' : Math.round(d) + ' m'
}

function renderList(data) {
  const box = document.getElementById('result')

  if (!data.length) {
    box.innerHTML = `
      <div class="empty">
        <div class="empty-icon">ğŸ˜•</div>
        <div class="empty-title">æš‚æ— æœç´¢ç»“æœ</div>
        <div class="empty-hint">è¯·å°è¯•å…¶ä»–åŸå¸‚æˆ–å…³é”®è¯</div>
      </div>`
    return
  }

  const header = `<div class="results-header">æ‰¾åˆ° <span>${data.length}</span> ä¸ªåœºåœ° Â· ç‚¹å‡»ã€Œå¯¼èˆªã€è·³è½¬é«˜å¾·åœ°å›¾</div>`

  const items = data.map((p, i) => {
    const name    = escHtml(p.name    || 'æœªçŸ¥åœºåœ°')
    const address = escHtml(p.address || 'åœ°å€æœªçŸ¥')
    const dist    = formatDistance(p.distance)
    const hasLoc  = p.location && p.location.lng && p.location.lat

    const distTag = dist
      ? `<span class="distance-tag">ğŸ“ ${dist}</span>`
      : ''

    const navBtn = hasLoc
      ? `<div class="nav-btn" onclick="nav(${p.location.lng},${p.location.lat},'${escHtml(p.name || '')}')">
           <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
             <polygon points="3 11 22 2 13 21 11 13 3 11"/>
           </svg>
           é«˜å¾·å¯¼èˆª
         </div>`
      : ''

    return `
      <div class="card" style="animation-delay:${i * 0.04}s">
        <div class="card-top">
          <div class="card-name">${name}</div>
          <div class="card-index">${String(i + 1).padStart(2, '0')}</div>
        </div>
        <div class="card-addr">${address}</div>
        <div class="card-footer">
          ${distTag}
          ${navBtn}
        </div>
      </div>`
  }).join('')

  box.innerHTML = header + items
}

function renderMarkers(data) {
  if (!map) return
  clearMarkers()
  data.forEach(p => {
    if (!p.location) return
    const m = new AMap.Marker({
      position: [p.location.lng, p.location.lat],
      title: p.name || '',
      map: map
    })
    markers.push(m)
  })
  if (markers.length > 0) map.setFitView(markers)
}

function nav(lng, lat, name) {
  window.open(
    `https://uri.amap.com/navigation?to=${lng},${lat},${encodeURIComponent(name)}&mode=car`,
    '_blank',
    'noopener,noreferrer'
  )
}

document.getElementById('cityInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') searchCity()
})
</script>

</body>
</html>
